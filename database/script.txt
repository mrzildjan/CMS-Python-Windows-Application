CREATE DATABASE CMS;

\c cms;

CREATE TABLE USERS(
  USER_ID INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 100 MINVALUE 1 MAXVALUE 1000000 CACHE 1 ),
  USER_FNAME VARCHAR(30) NOT NULL,
  USER_MNAME VARCHAR(30) NOT NULL,
  USER_LNAME VARCHAR(30) NOT NULL,
  USER_NUMBER VARCHAR(30) NOT NULL,
  USER_EMAIL VARCHAR(30) NOT NULL,
  USER_USERNAME VARCHAR(30) NOT NULL,
  USER_PASSWORD VARCHAR(30) NOT NULL,
  USER_IS_ADMIN BOOLEAN NOT NULL DEFAULT FALSE,
  USER_CREATED_AT TIMESTAMP NOT NULL,
  USER_UPDATED_AT TIMESTAMP NOT NULL,
  PRIMARY KEY (USER_ID)
);

CREATE TABLE RELATIVE (
  REL_ID INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 100 MINVALUE 1 MAXVALUE 1000000 CACHE 1 ),
  REL_FNAME VARCHAR(30) NOT NULL,
  REL_MNAME VARCHAR(30) NOT NULL,
  REL_LNAME VARCHAR(30) NOT NULL,
  REL_DOB DATE NOT NULL,
  REL_DATE_DEATH DATE NOT NULL,
  REL_DATE_INTERMENT DATE NOT NULL,
  REL_DATE_EXHUMATION DATE NOT NULL,
  USER_ID INTEGER,
  PRIMARY KEY (REL_ID),
  FOREIGN KEY (USER_ID) REFERENCES USERS (USER_ID) ON UPDATE CASCADE
);

CREATE TABLE PLOT (
  PLOT_ID VARCHAR(30) GENERATED ALWAYS AS (PLOT_YARD || PLOT_ROW || CAST(PLOT_COL AS VARCHAR)) STORED,
  PLOT_COL INTEGER NOT NULL,
  PLOT_ROW VARCHAR (30) NOT NULL,
  PLOT_YARD VARCHAR (30) NOT NULL,
  PLOT_STATUS VARCHAR (30) NOT NULL,
  PLOT_DATE TIMESTAMP,
  PRIMARY KEY (PLOT_ID)
);

CREATE TABLE TRANSACTION (
  TRANS_ID INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 100 MINVALUE 1 MAXVALUE 1000000 CACHE 1 ),
  TRANS_TYPE VARCHAR(10) NOT NULL,
  TRANS_STATUS VARCHAR(10) NOT NULL,
  TRANS_DATE TIMESTAMP NOT NULL,
  USER_ID INTEGER,
  REL_ID INTEGER,
  PLOT_ID VARCHAR(30),
  PRIMARY KEY(TRANS_ID),
  FOREIGN KEY (USER_ID) REFERENCES USERS (USER_ID) ON UPDATE CASCADE ON DELETE CASCADE,
  FOREIGN KEY (REL_ID) REFERENCES RELATIVE (REL_ID) ON UPDATE CASCADE ON DELETE CASCADE,
  FOREIGN KEY (PLOT_ID) REFERENCES PLOT (PLOT_ID) ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE RECORD (
  REC_ID INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 100 MINVALUE 1 MAXVALUE 1000000 CACHE 1 ),
  REC_LASTPAY_DATE TIMESTAMP NOT NULL,
  REC_LASTPAY_AMOUNT NUMERIC(8,2) NOT NULL,
  REC_STATUS VARCHAR(30) NOT NULL,
  PLOT_ID VARCHAR(30),
  REL_ID INTEGER,
  USER_ID INTEGER,
  PRIMARY KEY (REC_ID),
  FOREIGN KEY (USER_ID)  REFERENCES USERS(USER_ID),
  FOREIGN KEY (REL_ID) REFERENCES RELATIVE (REL_ID) ON UPDATE CASCADE ON DELETE CASCADE,
  FOREIGN KEY (PLOT_ID) REFERENCES PLOT (PLOT_ID) ON UPDATE CASCADE ON DELETE CASCADE
);

--
-- INSERT Plot Records
--
INSERT INTO PLOT (PLOT_COL, PLOT_ROW, PLOT_YARD, PLOT_STATUS, PLOT_DATE)
VALUES
  (1, 'A', 'San Bartolome', 'Available', CURRENT_TIMESTAMP),
  (2, 'A', 'San Bartolome', 'Available', CURRENT_TIMESTAMP),
  (3, 'A', 'San Bartolome', 'Available', CURRENT_TIMESTAMP),
  (4, 'A', 'San Bartolome', 'Available', CURRENT_TIMESTAMP),
  (5, 'A', 'San Bartolome', 'Available', CURRENT_TIMESTAMP),
  (6, 'A', 'San Bartolome', 'Available', CURRENT_TIMESTAMP),
  (7, 'A', 'San Bartolome', 'Available', CURRENT_TIMESTAMP),
  (8, 'A', 'San Bartolome', 'Available', CURRENT_TIMESTAMP),
  (9, 'A', 'San Bartolome', 'Available', CURRENT_TIMESTAMP),
  (10, 'A', 'San Bartolome', 'Available', CURRENT_TIMESTAMP),
  (1, 'B', 'San Bartolome', 'Available', CURRENT_TIMESTAMP),
  (2, 'B', 'San Bartolome', 'Available', CURRENT_TIMESTAMP),
  (3, 'B', 'San Bartolome', 'Available', CURRENT_TIMESTAMP),
  (4, 'B', 'San Bartolome', 'Available', CURRENT_TIMESTAMP),
  (5, 'B', 'San Bartolome', 'Available', CURRENT_TIMESTAMP),
  (6, 'B', 'San Bartolome', 'Available', CURRENT_TIMESTAMP),
  (7, 'B', 'San Bartolome', 'Available', CURRENT_TIMESTAMP),
  (8, 'B', 'San Bartolome', 'Available', CURRENT_TIMESTAMP),
  (9, 'B', 'San Bartolome', 'Available', CURRENT_TIMESTAMP),
  (10, 'B', 'San Bartolome', 'Available', CURRENT_TIMESTAMP),
  (1, 'C', 'San Bartolome', 'Available', CURRENT_TIMESTAMP),
  (2, 'C', 'San Bartolome', 'Available', CURRENT_TIMESTAMP),
  (3, 'C', 'San Bartolome', 'Available', CURRENT_TIMESTAMP),
  (4, 'C', 'San Bartolome', 'Available', CURRENT_TIMESTAMP),
  (5, 'C', 'San Bartolome', 'Available', CURRENT_TIMESTAMP),
  (6, 'C', 'San Bartolome', 'Available', CURRENT_TIMESTAMP),
  (7, 'C', 'San Bartolome', 'Available', CURRENT_TIMESTAMP),
  (8, 'C', 'San Bartolome', 'Available', CURRENT_TIMESTAMP),
  (9, 'C', 'San Bartolome', 'Available', CURRENT_TIMESTAMP),
  (10, 'C', 'San Bartolome', 'Available', CURRENT_TIMESTAMP),
  (1, 'D', 'San Bartolome', 'Available', CURRENT_TIMESTAMP),
  (2, 'D', 'San Bartolome', 'Available', CURRENT_TIMESTAMP),
  (3, 'D', 'San Bartolome', 'Available', CURRENT_TIMESTAMP),
  (4, 'D', 'San Bartolome', 'Available', CURRENT_TIMESTAMP),
  (5, 'D', 'San Bartolome', 'Available', CURRENT_TIMESTAMP),
  (6, 'D', 'San Bartolome', 'Available', CURRENT_TIMESTAMP),
  (7, 'D', 'San Bartolome', 'Available', CURRENT_TIMESTAMP),
  (8, 'D', 'San Bartolome', 'Available', CURRENT_TIMESTAMP),
  (9, 'D', 'San Bartolome', 'Available', CURRENT_TIMESTAMP),
  (10, 'D', 'San Bartolome', 'Available', CURRENT_TIMESTAMP),
  (1, 'E', 'San Bartolome', 'Available', CURRENT_TIMESTAMP),
  (2, 'E', 'San Bartolome', 'Available', CURRENT_TIMESTAMP),
  (3, 'E', 'San Bartolome', 'Available', CURRENT_TIMESTAMP),
  (4, 'E', 'San Bartolome', 'Available', CURRENT_TIMESTAMP),
  (5, 'E', 'San Bartolome', 'Available', CURRENT_TIMESTAMP),
  (6, 'E', 'San Bartolome', 'Available', CURRENT_TIMESTAMP),
  (7, 'E', 'San Bartolome', 'Available', CURRENT_TIMESTAMP),
  (8, 'E', 'San Bartolome', 'Available', CURRENT_TIMESTAMP),
  (9, 'E', 'San Bartolome', 'Available', CURRENT_TIMESTAMP),
  (10, 'E', 'San Bartolome', 'Available', CURRENT_TIMESTAMP),
  (1, 'A', 'San Isidro', 'Available', CURRENT_TIMESTAMP),
  (2, 'A', 'San Isidro', 'Available', CURRENT_TIMESTAMP),
  (3, 'A', 'San Isidro', 'Available', CURRENT_TIMESTAMP),
  (4, 'A', 'San Isidro', 'Available', CURRENT_TIMESTAMP),
  (5, 'A', 'San Isidro', 'Available', CURRENT_TIMESTAMP),
  (6, 'A', 'San Isidro', 'Available', CURRENT_TIMESTAMP),
  (7, 'A', 'San Isidro', 'Available', CURRENT_TIMESTAMP),
  (8, 'A', 'San Isidro', 'Available', CURRENT_TIMESTAMP),
  (9, 'A', 'San Isidro', 'Available', CURRENT_TIMESTAMP),
  (10, 'A', 'San Isidro', 'Available', CURRENT_TIMESTAMP),
  (1, 'B', 'San Isidro', 'Available', CURRENT_TIMESTAMP),
  (2, 'B', 'San Isidro', 'Available', CURRENT_TIMESTAMP),
  (3, 'B', 'San Isidro', 'Available', CURRENT_TIMESTAMP),
  (4, 'B', 'San Isidro', 'Available', CURRENT_TIMESTAMP),
  (5, 'B', 'San Isidro', 'Available', CURRENT_TIMESTAMP),
  (6, 'B', 'San Isidro', 'Available', CURRENT_TIMESTAMP),
  (7, 'B', 'San Isidro', 'Available', CURRENT_TIMESTAMP),
  (8, 'B', 'San Isidro', 'Available', CURRENT_TIMESTAMP),
  (9, 'B', 'San Isidro', 'Available', CURRENT_TIMESTAMP),
  (10, 'B', 'San Isidro', 'Available', CURRENT_TIMESTAMP),
  (1, 'C', 'San Isidro', 'Available', CURRENT_TIMESTAMP),
  (2, 'C', 'San Isidro', 'Available', CURRENT_TIMESTAMP),
  (3, 'C', 'San Isidro', 'Available', CURRENT_TIMESTAMP),
  (4, 'C', 'San Isidro', 'Available', CURRENT_TIMESTAMP),
  (5, 'C', 'San Isidro', 'Available', CURRENT_TIMESTAMP),
  (6, 'C', 'San Isidro', 'Available', CURRENT_TIMESTAMP),
  (7, 'C', 'San Isidro', 'Available', CURRENT_TIMESTAMP),
  (8, 'C', 'San Isidro', 'Available', CURRENT_TIMESTAMP),
  (9, 'C', 'San Isidro', 'Available', CURRENT_TIMESTAMP),
  (10, 'C', 'San Isidro', 'Available', CURRENT_TIMESTAMP),
  (1, 'D', 'San Isidro', 'Available', CURRENT_TIMESTAMP),
  (2, 'D', 'San Isidro', 'Available', CURRENT_TIMESTAMP),
  (3, 'D', 'San Isidro', 'Available', CURRENT_TIMESTAMP),
  (4, 'D', 'San Isidro', 'Available', CURRENT_TIMESTAMP),
  (5, 'D', 'San Isidro', 'Available', CURRENT_TIMESTAMP),
  (6, 'D', 'San Isidro', 'Available', CURRENT_TIMESTAMP),
  (7, 'D', 'San Isidro', 'Available', CURRENT_TIMESTAMP),
  (8, 'D', 'San Isidro', 'Available', CURRENT_TIMESTAMP),
  (9, 'D', 'San Isidro', 'Available', CURRENT_TIMESTAMP),
  (10, 'D', 'San Isidro', 'Available', CURRENT_TIMESTAMP),
  (1, 'E', 'San Isidro', 'Available', CURRENT_TIMESTAMP),
  (2, 'E', 'San Isidro', 'Available', CURRENT_TIMESTAMP),
  (3, 'E', 'San Isidro', 'Available', CURRENT_TIMESTAMP),
  (4, 'E', 'San Isidro', 'Available', CURRENT_TIMESTAMP),
  (5, 'E', 'San Isidro', 'Available', CURRENT_TIMESTAMP),
  (6, 'E', 'San Isidro', 'Available', CURRENT_TIMESTAMP),
  (7, 'E', 'San Isidro', 'Available', CURRENT_TIMESTAMP),
  (8, 'E', 'San Isidro', 'Available', CURRENT_TIMESTAMP),
  (9, 'E', 'San Isidro', 'Available', CURRENT_TIMESTAMP),
  (10, 'E', 'San Isidro', 'Available', CURRENT_TIMESTAMP),
  (1, 'A', 'San Pablo', 'Available', CURRENT_TIMESTAMP),
  (2, 'A', 'San Pablo', 'Available', CURRENT_TIMESTAMP),
  (3, 'A', 'San Pablo', 'Available', CURRENT_TIMESTAMP),
  (4, 'A', 'San Pablo', 'Available', CURRENT_TIMESTAMP),
  (5, 'A', 'San Pablo', 'Available', CURRENT_TIMESTAMP),
  (6, 'A', 'San Pablo', 'Available', CURRENT_TIMESTAMP),
  (7, 'A', 'San Pablo', 'Available', CURRENT_TIMESTAMP),
  (8, 'A', 'San Pablo', 'Available', CURRENT_TIMESTAMP),
  (9, 'A', 'San Pablo', 'Available', CURRENT_TIMESTAMP),
  (10, 'A', 'San Pablo', 'Available', CURRENT_TIMESTAMP),
  (1, 'B', 'San Pablo', 'Available', CURRENT_TIMESTAMP),
  (2, 'B', 'San Pablo', 'Available', CURRENT_TIMESTAMP),
  (3, 'B', 'San Pablo', 'Available', CURRENT_TIMESTAMP),
  (4, 'B', 'San Pablo', 'Available', CURRENT_TIMESTAMP),
  (5, 'B', 'San Pablo', 'Available', CURRENT_TIMESTAMP),
  (6, 'B', 'San Pablo', 'Available', CURRENT_TIMESTAMP),
  (7, 'B', 'San Pablo', 'Available', CURRENT_TIMESTAMP),
  (8, 'B', 'San Pablo', 'Available', CURRENT_TIMESTAMP),
  (9, 'B', 'San Pablo', 'Available', CURRENT_TIMESTAMP),
  (10, 'B', 'San Pablo', 'Available', CURRENT_TIMESTAMP),
  (1, 'C', 'San Pablo', 'Available', CURRENT_TIMESTAMP),
  (2, 'C', 'San Pablo', 'Available', CURRENT_TIMESTAMP),
  (3, 'C', 'San Pablo', 'Available', CURRENT_TIMESTAMP),
  (4, 'C', 'San Pablo', 'Available', CURRENT_TIMESTAMP),
  (5, 'C', 'San Pablo', 'Available', CURRENT_TIMESTAMP),
  (6, 'C', 'San Pablo', 'Available', CURRENT_TIMESTAMP),
  (7, 'C', 'San Pablo', 'Available', CURRENT_TIMESTAMP),
  (8, 'C', 'San Pablo', 'Available', CURRENT_TIMESTAMP),
  (9, 'C', 'San Pablo', 'Available', CURRENT_TIMESTAMP),
  (10, 'C', 'San Pablo', 'Available', CURRENT_TIMESTAMP),
  (1, 'D', 'San Pablo', 'Available', CURRENT_TIMESTAMP),
  (2, 'D', 'San Pablo', 'Available', CURRENT_TIMESTAMP),
  (3, 'D', 'San Pablo', 'Available', CURRENT_TIMESTAMP),
  (4, 'D', 'San Pablo', 'Available', CURRENT_TIMESTAMP),
  (5, 'D', 'San Pablo', 'Available', CURRENT_TIMESTAMP),
  (6, 'D', 'San Pablo', 'Available', CURRENT_TIMESTAMP),
  (7, 'D', 'San Pablo', 'Available', CURRENT_TIMESTAMP),
  (8, 'D', 'San Pablo', 'Available', CURRENT_TIMESTAMP),
  (9, 'D', 'San Pablo', 'Available', CURRENT_TIMESTAMP),
  (10, 'D', 'San Pablo', 'Available', CURRENT_TIMESTAMP),
  (1, 'E', 'San Pablo', 'Available', CURRENT_TIMESTAMP),
  (2, 'E', 'San Pablo', 'Available', CURRENT_TIMESTAMP),
  (3, 'E', 'San Pablo', 'Available', CURRENT_TIMESTAMP),
  (4, 'E', 'San Pablo', 'Available', CURRENT_TIMESTAMP),
  (5, 'E', 'San Pablo', 'Available', CURRENT_TIMESTAMP),
  (6, 'E', 'San Pablo', 'Available', CURRENT_TIMESTAMP),
  (7, 'E', 'San Pablo', 'Available', CURRENT_TIMESTAMP),
  (8, 'E', 'San Pablo', 'Available', CURRENT_TIMESTAMP),
  (9, 'E', 'San Pablo', 'Available', CURRENT_TIMESTAMP),
  (10, 'E', 'San Pablo', 'Available', CURRENT_TIMESTAMP),
  (1, 'A', 'Sta. Monica', 'Available', CURRENT_TIMESTAMP),
  (2, 'A', 'Sta. Monica', 'Available', CURRENT_TIMESTAMP),
  (3, 'A', 'Sta. Monica', 'Available', CURRENT_TIMESTAMP),
  (4, 'A', 'Sta. Monica', 'Available', CURRENT_TIMESTAMP),
  (5, 'A', 'Sta. Monica', 'Available', CURRENT_TIMESTAMP),
  (6, 'A', 'Sta. Monica', 'Available', CURRENT_TIMESTAMP),
  (7, 'A', 'Sta. Monica', 'Available', CURRENT_TIMESTAMP),
  (8, 'A', 'Sta. Monica', 'Available', CURRENT_TIMESTAMP),
  (9, 'A', 'Sta. Monica', 'Available', CURRENT_TIMESTAMP),
  (10, 'A', 'Sta. Monica', 'Available', CURRENT_TIMESTAMP),
  (1, 'B', 'Sta. Monica', 'Available', CURRENT_TIMESTAMP),
  (2, 'B', 'Sta. Monica', 'Available', CURRENT_TIMESTAMP),
  (3, 'B', 'Sta. Monica', 'Available', CURRENT_TIMESTAMP),
  (4, 'B', 'Sta. Monica', 'Available', CURRENT_TIMESTAMP),
  (5, 'B', 'Sta. Monica', 'Available', CURRENT_TIMESTAMP),
  (6, 'B', 'Sta. Monica', 'Available', CURRENT_TIMESTAMP),
  (7, 'B', 'Sta. Monica', 'Available', CURRENT_TIMESTAMP),
  (8, 'B', 'Sta. Monica', 'Available', CURRENT_TIMESTAMP),
  (9, 'B', 'Sta. Monica', 'Available', CURRENT_TIMESTAMP),
  (10, 'B', 'Sta. Monica', 'Available', CURRENT_TIMESTAMP),
  (1, 'C', 'Sta. Monica', 'Available', CURRENT_TIMESTAMP),
  (2, 'C', 'Sta. Monica', 'Available', CURRENT_TIMESTAMP),
  (3, 'C', 'Sta. Monica', 'Available', CURRENT_TIMESTAMP),
  (4, 'C', 'Sta. Monica', 'Available', CURRENT_TIMESTAMP),
  (5, 'C', 'Sta. Monica', 'Available', CURRENT_TIMESTAMP),
  (6, 'C', 'Sta. Monica', 'Available', CURRENT_TIMESTAMP),
  (7, 'C', 'Sta. Monica', 'Available', CURRENT_TIMESTAMP),
  (8, 'C', 'Sta. Monica', 'Available', CURRENT_TIMESTAMP),
  (9, 'C', 'Sta. Monica', 'Available', CURRENT_TIMESTAMP),
  (10, 'C', 'Sta. Monica', 'Available', CURRENT_TIMESTAMP),
  (1, 'D', 'Sta. Monica', 'Available', CURRENT_TIMESTAMP),
  (2, 'D', 'Sta. Monica', 'Available', CURRENT_TIMESTAMP),
  (3, 'D', 'Sta. Monica', 'Available', CURRENT_TIMESTAMP),
  (4, 'D', 'Sta. Monica', 'Available', CURRENT_TIMESTAMP),
  (5, 'D', 'Sta. Monica', 'Available', CURRENT_TIMESTAMP),
  (6, 'D', 'Sta. Monica', 'Available', CURRENT_TIMESTAMP),
  (7, 'D', 'Sta. Monica', 'Available', CURRENT_TIMESTAMP),
  (8, 'D', 'Sta. Monica', 'Available', CURRENT_TIMESTAMP),
  (9, 'D', 'Sta. Monica', 'Available', CURRENT_TIMESTAMP),
  (10, 'D', 'Sta. Monica', 'Available', CURRENT_TIMESTAMP),
  (1, 'E', 'Sta. Monica', 'Available', CURRENT_TIMESTAMP),
  (2, 'E', 'Sta. Monica', 'Available', CURRENT_TIMESTAMP),
  (3, 'E', 'Sta. Monica', 'Available', CURRENT_TIMESTAMP),
  (4, 'E', 'Sta. Monica', 'Available', CURRENT_TIMESTAMP),
  (5, 'E', 'Sta. Monica', 'Available', CURRENT_TIMESTAMP),
  (6, 'E', 'Sta. Monica', 'Available', CURRENT_TIMESTAMP),
  (7, 'E', 'Sta. Monica', 'Available', CURRENT_TIMESTAMP),
  (8, 'E', 'Sta. Monica', 'Available', CURRENT_TIMESTAMP),
  (9, 'E', 'Sta. Monica', 'Available', CURRENT_TIMESTAMP),
  (10, 'E', 'Sta. Monica', 'Available', CURRENT_TIMESTAMP),
  (1, 'A', 'Sta. Maria', 'Available', CURRENT_TIMESTAMP),
  (2, 'A', 'Sta. Maria', 'Available', CURRENT_TIMESTAMP),
  (3, 'A', 'Sta. Maria', 'Available', CURRENT_TIMESTAMP),
  (4, 'A', 'Sta. Maria', 'Available', CURRENT_TIMESTAMP),
  (5, 'A', 'Sta. Maria', 'Available', CURRENT_TIMESTAMP),
  (6, 'A', 'Sta. Maria', 'Available', CURRENT_TIMESTAMP),
  (7, 'A', 'Sta. Maria', 'Available', CURRENT_TIMESTAMP),
  (8, 'A', 'Sta. Maria', 'Available', CURRENT_TIMESTAMP),
  (9, 'A', 'Sta. Maria', 'Available', CURRENT_TIMESTAMP),
  (10, 'A', 'Sta. Maria', 'Available', CURRENT_TIMESTAMP),
  (1, 'B', 'Sta. Maria', 'Available', CURRENT_TIMESTAMP),
  (2, 'B', 'Sta. Maria', 'Available', CURRENT_TIMESTAMP),
  (3, 'B', 'Sta. Maria', 'Available', CURRENT_TIMESTAMP),
  (4, 'B', 'Sta. Maria', 'Available', CURRENT_TIMESTAMP),
  (5, 'B', 'Sta. Maria', 'Available', CURRENT_TIMESTAMP),
  (6, 'B', 'Sta. Maria', 'Available', CURRENT_TIMESTAMP),
  (7, 'B', 'Sta. Maria', 'Available', CURRENT_TIMESTAMP),
  (8, 'B', 'Sta. Maria', 'Available', CURRENT_TIMESTAMP),
  (9, 'B', 'Sta. Maria', 'Available', CURRENT_TIMESTAMP),
  (10, 'B', 'Sta. Maria', 'Available', CURRENT_TIMESTAMP),
  (1, 'C', 'Sta. Maria', 'Available', CURRENT_TIMESTAMP),
  (2, 'C', 'Sta. Maria', 'Available', CURRENT_TIMESTAMP),
  (3, 'C', 'Sta. Maria', 'Available', CURRENT_TIMESTAMP),
  (4, 'C', 'Sta. Maria', 'Available', CURRENT_TIMESTAMP),
  (5, 'C', 'Sta. Maria', 'Available', CURRENT_TIMESTAMP),
  (6, 'C', 'Sta. Maria', 'Available', CURRENT_TIMESTAMP),
  (7, 'C', 'Sta. Maria', 'Available', CURRENT_TIMESTAMP),
  (8, 'C', 'Sta. Maria', 'Available', CURRENT_TIMESTAMP),
  (9, 'C', 'Sta. Maria', 'Available', CURRENT_TIMESTAMP),
  (10, 'C', 'Sta. Maria', 'Available', CURRENT_TIMESTAMP),
  (1, 'D', 'Sta. Maria', 'Available', CURRENT_TIMESTAMP),
  (2, 'D', 'Sta. Maria', 'Available', CURRENT_TIMESTAMP),
  (3, 'D', 'Sta. Maria', 'Available', CURRENT_TIMESTAMP),
  (4, 'D', 'Sta. Maria', 'Available', CURRENT_TIMESTAMP),
  (5, 'D', 'Sta. Maria', 'Available', CURRENT_TIMESTAMP),
  (6, 'D', 'Sta. Maria', 'Available', CURRENT_TIMESTAMP),
  (7, 'D', 'Sta. Maria', 'Available', CURRENT_TIMESTAMP),
  (8, 'D', 'Sta. Maria', 'Available', CURRENT_TIMESTAMP),
  (9, 'D', 'Sta. Maria', 'Available', CURRENT_TIMESTAMP),
  (10, 'D', 'Sta. Maria', 'Available', CURRENT_TIMESTAMP),
  (1, 'E', 'Sta. Maria', 'Available', CURRENT_TIMESTAMP),
  (2, 'E', 'Sta. Maria', 'Available', CURRENT_TIMESTAMP),
  (3, 'E', 'Sta. Maria', 'Available', CURRENT_TIMESTAMP),
  (4, 'E', 'Sta. Maria', 'Available', CURRENT_TIMESTAMP),
  (5, 'E', 'Sta. Maria', 'Available', CURRENT_TIMESTAMP),
  (6, 'E', 'Sta. Maria', 'Available', CURRENT_TIMESTAMP),
  (7, 'E', 'Sta. Maria', 'Available', CURRENT_TIMESTAMP),
  (8, 'E', 'Sta. Maria', 'Available', CURRENT_TIMESTAMP),
  (9, 'E', 'Sta. Maria', 'Available', CURRENT_TIMESTAMP),
  (10, 'E', 'Sta. Maria', 'Available', CURRENT_TIMESTAMP);

--
-- TRIGGERS update_rel_date_exhumation
--

CREATE OR REPLACE FUNCTION update_rel_date_exhumation()
    RETURNS TRIGGER AS
$$
BEGIN
    NEW.rel_date_exhumation := NEW.rel_date_interment + INTERVAL '5 years';
    RETURN NEW;
END;
$$
LANGUAGE PLPGSQL;

CREATE TRIGGER trgr_update_rel_date_exhumation
    BEFORE INSERT ON RELATIVE
    FOR EACH ROW
    EXECUTE FUNCTION update_rel_date_exhumation();



ALTER TABLE RECORD
ALTER COLUMN rec_lastpay_date NOT NULL,
ALTER COLUMN rec_lastpay_amount NOT NULL;

UPDATE RECORD
SET rec_lastpay_date  = CURRENT_DATE,
SET rec_lastpay_amount = 500.00
WHERE REC_ID = 105;

--
-- FUNCTION delete_pending_records
--

CREATE OR REPLACE FUNCTION delete_pending_records()
  RETURNS VOID AS
$BODY$
DECLARE
    current_date_time TIMESTAMP := NOW();
    one_week_interval INTERVAL := INTERVAL '1 week';
BEGIN
    UPDATE PLOT
    SET plot_status = 'Available'
    WHERE plot_id IN (
        SELECT p.plot_id
        FROM PLOT p
        INNER JOIN TRANSACTION t ON p.plot_id = t.plot_id
        WHERE t.trans_status = 'Pending'
        AND t.trans_date < current_date_time - one_week_interval
    ) AND plot_id NOT IN (
        SELECT p.plot_id
        FROM TRANSACTION t
        INNER JOIN PLOT p ON p.plot_id = t.plot_id
        WHERE t.trans_type = 'Booked'
    );

    DELETE FROM RELATIVE
    WHERE rel_id IN (
        SELECT r.rel_id
        FROM RELATIVE r
        INNER JOIN TRANSACTION t ON r.rel_id = t.rel_id
        WHERE t.trans_status = 'Pending'
        AND t.trans_date < current_date_time - one_week_interval
    ) AND rel_id NOT IN (
        SELECT r.rel_id
        FROM TRANSACTION t
        INNER JOIN RELATIVE r ON r.rel_id = t.rel_id
        WHERE t.trans_type = 'Booked'
    );

    UPDATE TRANSACTION
    SET trans_status = 'Cancelled'
    WHERE trans_status = 'Pending'
    AND trans_date < current_date_time - one_week_interval;
END;
$BODY$
LANGUAGE plpgsql;