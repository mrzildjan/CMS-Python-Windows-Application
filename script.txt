CREATE DATABASE CMS;

CREATE TABLE "USER" (
  USER_ID INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 100 MINVALUE 1 MAXVALUE 1000000 CACHE 1 ),
  USER_FNAME VARCHAR(30) NOT NULL,
  USER_MNAME VARCHAR(30) NOT NULL,
  USER_LNAME VARCHAR(30) NOT NULL,
  USER_NUMBER CHAR(8) NOT NULL,
  USER_EMAIL VARCHAR(30) NOT NULL,
  USER_USERNAME VARCHAR(30) NOT NULL,
  USER_PASSWORD VARCHAR(30) NOT NULL,
  USER_IS_ADMIN BOOLEAN NOT NULL DEFAULT FALSE,
  USER_CREATED_AT DATE NOT NULL,
  USER_UPDATED_AT DATE NOT NULL,
  PRIMARY KEY (USER_ID)
);

CREATE TABLE RELATIVE (
  REL_ID INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 100 MINVALUE 1 MAXVALUE 1000000 CACHE 1 ),
  REL_FNAME VARCHAR(30) NOT NULL,
  REL_MNAME VARCHAR(30) NOT NULL,
  REL_LNAME VARCHAR(30) NOT NULL,
  REL_DOB DATE NOT NULL,
  REL_DATE_DEATH DATE NOT NULL,
  REL_DATE_INTERMENT DATE NOT NULL,
  REL_DATE_EXHUMATION DATE NOT NULL,
  USER_ID INTEGER,
  PRIMARY KEY (REL_ID),
  FOREIGN KEY (USER_ID) REFERENCES "USER" (USER_ID) ON UPDATE CASCADE
);

CREATE TABLE PLOT (
  PLOT_ID VARCHAR(30) NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 100 MINVALUE 1 MAXVALUE 1000000 CACHE 1 ),
  PLOT_COL INTEGER NOT NULL,
  PLOT_ROW VARCHAR (30) NOT NULL,
  PLOT_YARD VARCHAR (30) NOT NULL,
  PLOT_STATUS VARCHAR (30) NOT NULL,
  PRIMARY KEY (SUBSTRING(PLOT_YARD, 1, 3) || PLOT_ROW || PLOT_COL)
);


CREATE TABLE TRANSACTION (
  TRANS_ID INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 100 MINVALUE 1 MAXVALUE 1000000 CACHE 1 ),
  TRANS_TYPE VARCHAR(10) NOT NULL,
  TRANS_STATUS VARCHAR(10) NOT NULL,
  TRANS_DATE DATE NOT NULL,
  USER_ID INTEGER,
  REL_ID INTEGER,
  PLOT_ID INTEGER,
  PRIMARY KEY(TRANS_ID),
  FOREIGN KEY (USER_ID) REFERENCES "USER" (USER_ID) ON UPDATE CASCADE ON DELETE CASCADE,
  FOREIGN KEY (REL_ID) REFERENCES RELATIVE (REL_ID) ON UPDATE CASCADE ON DELETE CASCADE,
  FOREIGN KEY (PLOT_ID) REFERENCES PLOT (PLOT_ID) ON UPDATE CASCADE ON DELETE CASCADE
);


CREATE TABLE RECORD (
  REC_ID INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 100 MINVALUE 1 MAXVALUE 1000000 CACHE 1 ),
  REC_LASTPAY_DATE DATE NOT NULL,
  REC_LASTPAY_AMOUNT NUMERIC(8,2) NOT NULL,
  REC_STATUS VARCHAR(10) NOT NULL,
  PLOT_ID INTEGER,
  REL_ID INTEGER,
  USER_ID INTEGER,
  PRIMARY KEY (REC_ID)
  FOREIGN KEY (USER_ID)  REFERENCES "USER"(USER_ID),
  FOREIGN KEY (REL_ID) REFERENCES RELATIVE (REL_ID) ON UPDATE CASCADE ON DELETE CASCADE,
  FOREIGN KEY (PLOT_ID) REFERENCES PLOT (PLOT_ID) ON UPDATE CASCADE ON DELETE CASCADE
);